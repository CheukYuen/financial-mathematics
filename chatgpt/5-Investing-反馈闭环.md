# 资产配置体系说明（存档版）

> 本文为后续全部 Slides 与模型实现的“单一事实来源（SSoT）”。
> 主题：**Goals-Based（面向客户目标）**的方法论之上，采用 **CMA/CME → MPT/MVO（SAA） → BL Overlay → TAA & Rebalancing** 的分层+反馈闭环。
> 结论要点：这不是一次性串行流程，而是**主干（长期基线）＋覆盖（观点）＋执行（短期微调）**的体系，并且有**双向反馈**与**不同更新节奏**。

---

## 0. 顶层方法：Goals-Based（面向目标）

* **定义**：以客户**目标/时间线/约束/现金流**为驱动，先分桶（应急、教育、养老等），再将**策略与产品**映射到各桶。
* **与模型关系**：Goals-Based 负责**用户与约束侧**；CMA/MVO/BL/TAA 负责**资产与执行侧**。两边通过**约束与KPI（收益区间、波动/回撤、SLA流动性）**对齐。

---

## 1. 分层结构与关系（不是串行，而是主干+覆盖+执行）

### 1.1 模块定位

* **CMA/CME**（Capital Market Assumptions/Expectations）
  产出长期**μ（期望回报）、Σ（风险/相关性）**的**口径与区间**（基线/悲观/乐观）。
  **向下喂给** MVO（算 SAA）；也可直接作为 BL 的先验参考。
* **MPT/MVO → SAA（Strategic Asset Allocation）**
  在**约束**下用 μ、Σ 求出**长期基准权重 w_SAA**（主干）。
  **被 BL 覆盖**（观点的小幅、可解释偏移）。
* **BL（Black–Litterman Overlay）**
  把“人的观点”做成**后验 μ_BL**，再**回到 MVO**算出 **w_BL**（不是线性下一步，而是覆盖层）。
* **TAA（Tactical Asset Allocation）**
  基于**短期信号**，在 **w_SAA 或 w_BL** 周围，做**小幅机动（±上限）**，受**流动性/执行**约束。执行与KPI反馈**反向影响**TAA幅度，必要时触发**SAA复盘或CMA更新**。

### 1.2 数据流 vs 控制流（ASCII 总览）

```
画像/资金/目标 ─► 产品标签/流动性 ─► CMA/CME ─┬─► MVO → w_SAA
                                            │
                                            └─► BL(μ→μ_BL) ─► MVO → w_BL
                                                               │
                                        短期信号(宏观/估值/技术/资金/事件)
                                                               ▼
                                                  TAA(±cap, 约束检查) → w_TAA → 执行/再平衡
                                                               ▲
                      执行/费用/流动性/KPI反馈 ───────────────────┘（限制未来TAA幅度/触发SAA复盘/CMA更新）
```

---

## 2. 时间节奏与治理

* **CMA/CME**：年/半年为主（重大宏观变局可临时更新）；“慢变量”。
* **SAA（via MVO）**：年/半年滚动；投委会/治理层触发；“中慢变量”。
* **BL Overlay**：月/季（观点发生才更新）；“中变量”。
* **TAA**：周/月（有的机构日度监控，但动作受幅度与阈值约束）；“快变量”。

> 频率越快，权重偏离容许越小；频率越慢，对长期目标影响越大。

---

## 3. 约束与边界（贯穿全链路）

* **硬约束**：∑w=1；大类/单品上下限；**流动性SLA（7日可变现≥阈值）**；波动/回撤上限；合规/集中度。
* **软约束**：交易成本/税务、实施窗口、系统可达性。
* **执行优先**：TAA 必须先过**流动性闸门**与**可达性检查**；纸面最优不一定执行。
* **反馈**：若执行层频繁撞闸（流动性不足/成本过高），应**回头调 SAA 上限或CMA口径**。

---

## 4. 各模块的“易懂版”与“专业版”

> 下面每个模块给两层内容：**易懂版（业务讲解）**＋**专业版（可落地代码接口）**。

### 4.1 CMA/CME（资本市场预期）

**易懂版**

* 做什么：用公开指标推导各类资产的**期望收益 μ**区间（基线/悲观/乐观），作为后续优化的起点。
* 口径示例：

  * 债券≈当前到期收益率（YTM）；
  * 股票≈股息率 + 长期盈利增速 + 估值回归（中性）；
  * 黄金/商品≈对通胀/实际利率的敏感度（β）；
  * REITs≈分红率 + 租金增长口径。
* 原则：**μ 是“预期”，非保证**；先定义**口径**，再给**区间**。

**专业版（函数）**

* `estimate_mu_cme(market_indicators, assets, scenario_labels) -> MarketAssumptions`

  * **输入**：公开指标（利率/通胀/股息/盈利等）、资产清单、场景标签
  * **输出**：`mu`（占位/区间）、`mu_scn`（分场景占位）、`notes`（口径说明）

### 4.2 MPT/MVO → SAA（基准组合）

**易懂版**

* 做什么：在约束下，用 **μ** 与 **Σ（同涨同跌地图）**选择**更稳妥的拼法**，求出**长期基准权重 w_SAA**。
* 检查点：相关性热力（同源/集中）、风险分解（边际/成分）、**先满足SLA/波动**再谈收益。

**专业版（函数）**

* `optimize_mvo(mu_vec, risk: RiskModel, cons: Constraints, objective="meanvar"|"max_sharpe") -> (w_SAA, risk_meta)`

  * **输入**：`mu`（选定场景的向量）、`Sigma`、约束（上下限、波动、SLA）
  * **输出**：`w_SAA`、`risk_meta`（组合方差/风险贡献/同源证据）

### 4.3 BL（Black–Litterman Overlay）

**易懂版**

* 做什么：把“**人的观点**”做成**可量化的轻微偏移**，得到**后验 μ_BL**；再回到 MVO 得出 **w_BL**。
* 原则：观点要**可解释且克制**（把握度强=偏移略大；弱=更靠近基线）。

**专业版（函数）**

* `black_litterman(Sigma, pi, P, q, Omega, tau) -> mu_BL`（后再 MVO → `w_BL`）

  * **输入**：`Sigma`、市场隐含回报`pi`、观点矩阵`P`/向量`q`、观点不确定度`Omega`、尺度`tau`
  * **输出**：`mu_BL`（后验期望）

### 4.4 TAA（战术/执行）

**易懂版**

* 做什么：用**短期信号打分**做**小幅战术偏移（±上限）**，在**流动性/执行约束**内**可落地**；按偏离阈值**触发再平衡**。
* 类比：**β=拨杆灵敏度**，拨一点、权重动一点；**先过流动性闸门**再执行。

**专业版（函数）**

* `apply_taa(w_base, signals: TAASignals, cons: Constraints, risk: RiskModel) -> {w_TAA, checks, rebalance}`

  * **输入**：`w_base`（w_SAA或w_BL）、标准化信号向量`s`、灵敏度矩阵`B`、幅度上限/再平衡带、约束与`Sigma`
  * **输出**：`w_TAA`（可执行权重）、`checks`（流动性/波动可达）、`rebalance`（触发项）

---

## 5. 典型互动与回路（为何“来回走”）

* **宏观变局** → **CMA**更新 → 触发 **SAA**复盘；BL 观点自动**收敛/重校**。
* **执行频繁撞流动性闸门** → 说明 **SAA 低流动性占比过高** → 回调 **SAA 边界**。
* **BL 偏多某主题**但 **MVO 显示同源严重** → 下调观点把握度（Ω/τ），或回归 SAA。
* **TAA 信号一致要降权益**但已到最小权重 → **不动作**；提示再平衡或上提治理层复盘。

---

## 6. 端到端最小调用骨架（占位版）

```python
# 0) 基础对象（assets, constraints, Sigma 等）
assets = ["cash","short_bond","credit","equity_div","equity_growth","gold","reits","commodity"]
cons = Constraints(bounds={a:(0.0,1.0) for a in assets}, vol_cap=None, liq_floor_7d=0.35)
risk = RiskModel(Sigma=np.eye(len(assets)), assets=assets, vol_annual={a:0.1 for a in assets})

# 1) CMA：构造 μ（场景占位）
ma = estimate_mu_cme(market_indicators=pd.DataFrame(), assets=assets)

# 2) MVO：μ_base + Σ → w_SAA
mu_base = np.zeros((len(assets),1))  # 此处仅占位；实际使用 ma.mu 或 ma.mu_scn["base"]
w_SAA, risk_meta = optimize_mvo(mu_base, risk, cons)

# 3) BL：μ_BL → w_BL
pi = np.zeros((len(assets),1)); P = np.zeros((1,len(assets))); q = np.zeros((1,1)); Omega = np.eye(1)
mu_BL = black_litterman(risk.Sigma, pi, P, q, Omega, tau=0.05)
w_BL, _ = optimize_mvo(mu_BL, risk, cons)

# 4) TAA：信号→Δw→w_TAA
signals = TAASignals(s=np.zeros((3,1)), B=np.zeros((len(assets),3)), tactical_cap=0.05, rebalance_band=0.20)
taa_out = apply_taa(w_BL, signals, cons, risk)
```

---

# Slides 规划（逐页生成指引）

> 目标：让非量化观众“先懂后信”，再给工程同事“能落地的接口”。每页均可用 Figma Make 生成。

## A. 现状与问题（1–3）

1. **Slide 1｜三大问题总览 + KPI 红黄绿灯**

   * 目标：一屏看懂“低收益/高风险/流动性”与KPI差距。
   * 视觉：三列问题卡 + 三张KPI灯。
2. **Slide 2｜资产构成可视化（四大类饼图 + 大类‘假设清单’）**

   * 目标：把问题落在具体构成；只列“假设（待校验）”。
   * 视觉：饼图（小尺寸、外部标签）+ 四列表（大类｜假设｜证据需求｜校验路径）。
3. **Slide 3｜资产构成可视化（细分类别饼图 + 细分‘假设清单’）**

   * 目标：暴露细分层面潜在坑；仍为“假设（待校验）”。

## B. 方法主线（4A–4B）

4. **Slide 4A｜模型路线图（业务讲解版·可读性增强）**

   * 目标：解释“不是串行”的主干+覆盖+执行+反馈；融合 μ/Σ/β 的浅白解释与小示意图。
   * 视觉：四卡 + 箭头 + 卡内易懂文案（已给）。
5. **Slide 4B｜模型路线图（Python 字段/伪代码版）**

   * 目标：给工程侧字段与接口；与4A同结构。
   * 视觉：四卡 + 代码块 + 字段表（已给函数与数据类）。

## C. 目标与口径（5–7）

6. **Slide 5｜Goals-Based 分桶与KPI口径**

   * 目标：客户现金流/目标/时间线→收益带、波动上限、SLA 口径。
   * 视觉：分桶表 + 目标收益带区间条。
7. **Slide 6｜CMA/CME 口径与场景区间（无数值）**

   * 目标：公开指标→口径→场景区间；强调“预期非保证”。
   * 视觉：条形带（Base/Bear/Bull）+ 口径注释。
8. **Slide 7｜相关性与集中度（Σ 热力 + 风险分解示意）**

   * 目标：为什么要分散；同源/集中证据如何出现。
   * 视觉：小热力图 + 边际/成分风险堆叠条。

## D. 组合与观点（8–10）

9. **Slide 8｜SAA（via MVO）结果呈现（不放数值，仅结构）**

   * 目标：展示“更稳妥的拼法”的结构与证据回填位。
   * 视觉：柱状/桑基从T0到SAA结构对比（遮数值，用等级或方向箭头）。
10. **Slide 9｜BL Overlay（观点→轻微偏移→可解释）**

    * 目标：观点如何被量化；偏移不大、能复述原因。
    * 视觉：指针偏移小示意 + 观点列表（作用资产/方向/把握度）。
11. **Slide 10｜TAA & 再平衡（信号拨杆与闸门）**

    * 目标：短期信号如何转成±偏移、如何通过SLA闸门与阈值触发。
    * 视觉：拨杆/阈值条 + 再平衡触发示意。

## E. 执行与复盘（11–13）

12. **Slide 11｜执行可达性与费用影响（SLA/费率/时间窗）**

    * 目标：纸面最优≠可执行；展示闸门前后对比。
    * 视觉：对勾/叉图标 + 流程闸门。
13. **Slide 12｜KPI 看板（目标带 vs 当前）**

    * 目标：收益带、波动、SLA 的当前状态；仅显示区间/指针，不放数值。
    * 视觉：三仪表/区间条。
14. **Slide 13｜反馈闭环（何时触发SAA复盘/CMA更新）**

    * 目标：明确定义触发条件（频繁撞闸/市场regime变/治理会议）。
    * 视觉：事件→动作流程图。

## F. 工程落地（14）

15. **Slide 14｜Notebook/Service 接口与目录**

    * 目标：列出数据类、函数清单、端到端调用顺序、文件目录。
    * 视觉：代码块 + 流程概览。

---

### 使用建议

* 先按本存档生成 **Slide 1–4**（你已基本就绪），再逐页扩展。
* 每页“只讲口径与结构”，**不展示主观数值**；数值放到 Notebook 演算或内部评审稿。
* 关键页面（4A、10、13）建议保留“反馈/闸门/阈值”的图形元素，形成“治理感”。

需要的话，我可以把 **Slide 5–14 的 Figma Make 指令模板**分批给你，一页一页生成。
